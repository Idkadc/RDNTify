<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDNT | Global Synthesis Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #030305;
            color: #ffffff;
            overflow-x: hidden;
        }

        .studio-glass {
            background: rgba(15, 15, 20, 0.85);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 2rem;
        }

        /* Generation Overlay */
        #loader-overlay {
            background: rgba(10, 10, 15, 0.94);
            backdrop-filter: blur(12px);
            display: none;
            position: absolute;
            inset: 0;
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 3rem;
            text-align: center;
        }

        .progress-track {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 99px;
            overflow: hidden;
            width: 100%;
            margin-top: 2rem;
            max-width: 320px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #3b82f6, #6366f1, #a855f7);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
            transition: width 0.3s ease-out;
        }

        .btn-brand {
            background: #ffffff;
            color: #000000;
            transition: all 0.4s cubic-bezier(0.2, 1, 0.3, 1);
        }

        .btn-brand:hover:not(:disabled) {
            background: #3b82f6;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -10px rgba(59, 130, 246, 0.5);
        }

        #main-display {
            max-height: 70vh;
            filter: drop-shadow(0 40px 80px rgba(0, 0, 0, 0.8));
            border-radius: 1.5rem;
            object-fit: contain;
        }

        .history-thumb {
            aspect-ratio: 1;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
            background: #000;
        }

        .history-thumb:hover {
            transform: scale(1.08) translateY(-4px);
            border-color: #3b82f6;
        }

        .mood-slot {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1.5rem;
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen pb-24">

    <div class="max-w-7xl mx-auto px-6 py-10">
        <!-- Header -->
        <header class="flex flex-col md:flex-row items-center justify-between mb-16 gap-8">
            <div class="flex items-center gap-6">
                <div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center shadow-2xl">
                    <span class="text-black font-black text-3xl tracking-tighter italic">RDNT</span>
                </div>
                <div>
                    <h1 class="text-4xl font-black tracking-tight uppercase italic">DESIGN <span class="text-blue-500">STUDIO</span></h1>
                    <p class="text-[11px] font-bold text-slate-600 tracking-[0.6em] uppercase">Global Aesthetic Synthesis</p>
                </div>
            </div>

            <div class="flex items-center gap-4 bg-white/5 px-8 py-4 rounded-full border border-white/5">
                <div id="engine-light" class="w-2 h-2 rounded-full bg-slate-800"></div>
                <span id="engine-text" class="text-[11px] font-black uppercase tracking-widest text-slate-500">Engine Standby</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
            <!-- CANVAS AREA -->
            <div class="lg:col-span-7 flex flex-col gap-8">
                <div id="studio-canvas" class="studio-glass p-12 relative overflow-hidden flex items-center justify-center min-h-[650px] bg-[#08080a] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)]">
                    
                    <!-- Darkened Progress Overlay -->
                    <div id="loader-overlay">
                        <div class="w-full max-w-sm">
                            <div class="flex justify-between items-end mb-2">
                                <div class="text-left">
                                    <p id="loader-step" class="text-[11px] font-black uppercase tracking-[0.5em] text-blue-400 mb-2">Synthesizing</p>
                                    <p id="loader-msg" class="text-xl font-bold text-white italic">Preserving brand identity...</p>
                                </div>
                                <p id="loader-pct" class="text-4xl font-black text-white/10 italic">0%</p>
                            </div>
                            <div class="progress-track">
                                <div id="loader-bar" class="progress-fill"></div>
                            </div>
                            <p class="mt-8 text-[10px] font-black uppercase tracking-[0.4em] text-slate-600">Generating Neural Texture Maps</p>
                        </div>
                    </div>

                    <!-- Main Image View -->
                    <img id="main-view" src="" alt="" class="w-full h-auto hidden z-10">
                    
                    <!-- Initial State -->
                    <div id="upload-prompt" class="flex flex-col items-center text-center max-w-sm z-10">
                        <div class="w-24 h-24 bg-blue-500/10 rounded-[2.5rem] flex items-center justify-center mb-8 border border-white/5 shadow-2xl">
                            <i class="fas fa-file-arrow-up text-blue-500 text-3xl"></i>
                        </div>
                        <h2 class="text-3xl font-black mb-4 uppercase tracking-tight">Sync Asset</h2>
                        <p class="text-slate-500 text-sm mb-12 leading-relaxed">Upload a hoodie or garment asset. The engine will transform the entire look while ensuring the RDNT brand is professionally integrated.</p>
                        <label class="cursor-pointer px-14 py-5 bg-white text-black font-black uppercase tracking-widest text-xs rounded-2xl transition-all hover:bg-blue-600 hover:text-white shadow-2xl">
                            Upload File
                            <input type="file" id="garment-upload" accept="image/*" class="hidden">
                        </label>
                    </div>

                    <!-- Canvas Actions -->
                    <div id="canvas-actions" class="absolute bottom-10 right-10 flex gap-4 hidden z-20">
                        <button onclick="downloadOutput()" class="w-14 h-14 bg-slate-900/80 backdrop-blur-md hover:bg-white/10 rounded-2xl flex items-center justify-center border border-white/10 transition-all shadow-xl">
                            <i class="fas fa-download text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- CONTROLS AREA -->
            <div class="lg:col-span-5 flex flex-col gap-10">
                <div class="studio-glass p-12 shadow-2xl relative border-t border-white/5">
                    <div class="mb-12">
                        <h2 class="text-3xl font-black mb-3 tracking-tight uppercase italic">Creative Directive</h2>
                        <p class="text-slate-500 text-xs leading-relaxed uppercase tracking-wider">
                            Global transformation mode active. <br>Fabric, color, and context will adapt completely.
                        </p>
                    </div>

                    <!-- Persistent Mood Ref -->
                    <div class="mood-slot p-6 mb-10">
                        <div class="flex items-center justify-between mb-5">
                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Aesthetic Mood Reference</p>
                            <label class="text-[10px] font-bold text-blue-400 cursor-pointer hover:underline uppercase">
                                Update
                                <input type="file" id="mood-upload" accept="image/*" class="hidden">
                            </label>
                        </div>
                        <div id="mood-container" class="w-full aspect-video rounded-2xl bg-black/40 border border-white/5 overflow-hidden flex items-center justify-center group">
                            <img id="mood-view" src="" class="w-full h-full object-cover hidden">
                            <div id="mood-placeholder" class="text-center opacity-30 group-hover:opacity-100 transition-opacity">
                                <i class="fas fa-image text-2xl mb-2 block"></i>
                                <span class="text-[9px] font-bold uppercase tracking-widest italic">Optional Context Ref</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div class="relative">
                            <textarea id="ai-input" 
                                placeholder="Example: 'Transform the garment into heavy charcoal canvas with neon blue circuit board glow'..." 
                                class="w-full h-44 bg-black border border-white/5 rounded-[2rem] p-8 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder:text-slate-800 resize-none font-medium"
                            ></textarea>
                        </div>

                        <button id="synth-trigger" disabled class="btn-brand w-full py-6 rounded-[2rem] font-black uppercase tracking-[0.4em] text-[11px] shadow-2xl disabled:opacity-5 disabled:grayscale disabled:cursor-not-allowed flex items-center justify-center gap-4">
                            Initiate Synthesis <i class="fas fa-bolt text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- History Log -->
                <div class="px-2">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-[11px] font-black uppercase tracking-[0.5em] text-slate-700 italic">Studio Archive</h3>
                        <span id="history-badge" class="px-3 py-1 bg-white/5 text-slate-600 text-[10px] font-black rounded-full uppercase tracking-tighter">0 FILES</span>
                    </div>
                    <div id="history-grid" class="grid grid-cols-4 gap-4">
                        <!-- Iterations -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 border border-white/5 px-10 py-6 rounded-3xl shadow-2xl flex items-center gap-6 opacity-0 translate-y-24 transition-all duration-500 z-[1100]">
        <div class="w-12 h-12 rounded-2xl bg-blue-500/20 flex items-center justify-center text-blue-400">
            <i class="fas fa-sync-alt"></i>
        </div>
        <div class="flex flex-col">
            <p class="text-[11px] font-black uppercase text-slate-500 tracking-widest">Asset Sync</p>
            <p id="toast-msg" class="text-sm font-bold text-white tracking-tight">Identity verified.</p>
        </div>
    </div>

    <script>
        const apiKey = ""; // Runtime provides key automatically
        const model = "gemini-2.5-flash-image-preview";
        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        const garmentInput = document.getElementById('garment-upload');
        const moodInput = document.getElementById('mood-upload');
        const aiInput = document.getElementById('ai-input');
        const synthTrigger = document.getElementById('synth-trigger');
        const mainView = document.getElementById('main-view');
        const moodView = document.getElementById('mood-view');
        const uploadPrompt = document.getElementById('upload-prompt');
        const moodPlaceholder = document.getElementById('mood-placeholder');
        const loaderOverlay = document.getElementById('loader-overlay');
        const historyGrid = document.getElementById('history-grid');

        let garmentB64 = null;
        let moodB64 = null;
        let isSynthesizing = false;

        // 1. ASSET HANDLERS
        garmentInput.addEventListener('change', (e) => handleAsset(e, 'garment'));
        moodInput.addEventListener('change', (e) => handleAsset(e, 'mood'));

        function handleAsset(e, type) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const b64 = event.target.result.split(',')[1];
                if (type === 'garment') {
                    garmentB64 = b64;
                    mainView.src = event.target.result;
                    mainView.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                    document.getElementById('canvas-actions').classList.remove('hidden');
                    synthTrigger.disabled = false;
                    
                    document.getElementById('engine-light').className = "w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_15px_#3b82f6]";
                    document.getElementById('engine-text').innerText = "Engine Ready";
                    document.getElementById('engine-text').className = "text-[11px] font-black uppercase tracking-widest text-blue-400";
                    
                    addHistory(event.target.result);
                } else {
                    moodB64 = b64;
                    moodView.src = event.target.result;
                    moodView.classList.remove('hidden');
                    moodPlaceholder.classList.add('hidden');
                    showToast("Mood reference synchronized.");
                }
            };
            reader.readAsDataURL(file);
        }

        // 2. SYNTHESIS ENGINE
        async function runSynthesis() {
            const promptStr = aiInput.value.trim();
            if (!promptStr || !garmentB64 || isSynthesizing) return;

            // Trigger Darkened Overlay Instantly
            isSynthesizing = true;
            loaderOverlay.style.display = "flex";
            
            // Allow UI to paint the loader
            setTimeout(async () => {
                animateProgress();

                const systemPrompt = `
                    STREETWEAR BRAND SYNTHESIS PROTOCOL:
                    Brand: RDNT
                    1. Identity preservation: The final garment MUST feature the text "RDNT" on the center chest area.
                    2. Logo Style: High-distressed collegiate varsity font. If the input hoodie is blank, you MUST add this logo in its signature style.
                    3. Global Transformation: The user wants to change the ENTIRE garment style based on: "${promptStr}". Transform fabric material, color, distress level, and lighting.
                    ${moodB64 ? "4. Mood Blending: Incorporate the aesthetic vibe and palette of the provided style reference image." : ""}
                    Action: Re-render the whole garment into a new photorealistic design asset while maintaining the RDNT brand identity.
                `;

                const contents = [{
                    parts: [
                        { text: systemPrompt },
                        { inlineData: { mimeType: "image/webp", data: garmentB64 } }
                    ]
                }];
                if (moodB64) contents[0].parts.push({ inlineData: { mimeType: "image/webp", data: moodB64 } });

                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents, 
                            generationConfig: { responseModalities: ["TEXT", "IMAGE"] } 
                        })
                    });

                    if (!response.ok) {
                        const errData = await response.json();
                        throw new Error(errData.error?.message || "Synthesis Engine Error");
                    }

                    const data = await response.json();
                    const outputPart = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData);

                    if (outputPart) {
                        const finalUrl = `data:image/png;base64,${outputPart.inlineData.data}`;
                        mainView.src = finalUrl;
                        garmentB64 = outputPart.inlineData.data; 
                        addHistory(finalUrl);
                        completeProgress();
                    } else {
                        throw new Error("Neural output failure: No image asset returned.");
                    }

                } catch (err) {
                    showToast("Critical Fault: " + err.message);
                    loaderOverlay.style.display = "none";
                    isSynthesizing = false;
                }
            }, 100);
        }

        // 3. PROGRESS LOGIC
        let pVal = 0;
        let pInt;
        const phases = [
            { p: 0, s: "IDENTITY", m: "Embedding brand signatures..." },
            { p: 25, s: "MAPPING", m: "Scanning garment silhouette..." },
            { p: 50, s: "SYNTHESIS", m: "Blending style references..." },
            { p: 75, s: "RENDERING", m: "Applying lighting physics..." },
            { p: 90, s: "STITCHING", m: "Finalizing asset..." }
        ];

        function animateProgress() {
            pVal = 0;
            updateUI(0);
            pInt = setInterval(() => {
                if (pVal < 98) {
                    pVal += Math.random() * 0.45;
                    updateUI(pVal);
                    const phase = phases.findLast(ph => pVal >= ph.p);
                    if (phase) {
                        document.getElementById('loader-step').innerText = phase.s;
                        document.getElementById('loader-msg').innerText = phase.m;
                    }
                }
            }, 150);
        }

        function updateUI(v) {
            document.getElementById('loader-bar').style.width = v + '%';
            document.getElementById('loader-pct').innerText = Math.floor(v) + '%';
        }

        function completeProgress() {
            clearInterval(pInt);
            updateUI(100);
            document.getElementById('loader-step').innerText = "STITCHED";
            document.getElementById('loader-msg').innerText = "Brand identity verified.";
            setTimeout(() => {
                loaderOverlay.style.display = "none";
                isSynthesizing = false;
            }, 1000);
        }

        // 4. HELPERS
        function addHistory(url) {
            const card = document.createElement('div');
            card.className = "history-thumb";
            card.innerHTML = `<img src="${url}" class="w-full h-full object-cover">`;
            card.onclick = () => { mainView.src = url; garmentB64 = url.split(',')[1]; };
            historyGrid.prepend(card);
            document.getElementById('history-badge').innerText = `${historyGrid.children.length} FILES`;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.replace('opacity-0', 'opacity-100');
            t.classList.replace('translate-y-24', 'translate-y-0');
            setTimeout(() => {
                t.classList.replace('opacity-100', 'opacity-0');
                t.classList.replace('translate-y-0', 'translate-y-24');
            }, 4000);
        }

        function downloadOutput() {
            const a = document.createElement('a');
            a.href = mainView.src;
            a.download = `RDNT-SYNTHESIS-${Date.now()}.png`;
            a.click();
        }

        synthTrigger.addEventListener('click', runSynthesis);
    </script>
</body>
</html>
